<!DOCTYPE html>
<html lang="en_US">

<head>
    <link href="common.css" rel="stylesheet" type="text/css">
    <link href="sprite.css" rel="stylesheet" type="text/css">
    <link href="multi2.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <style>
        .tier__icon {
            vertical-align: baseline !important;
        }
        .multi2__item .summoner-summary .last-updated {
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="ContentWrap">
        <div class="multi2">
            <div class="multi2__box">
                <ul class="multi2__list">
                    <template class="player_template">
                        <li class="multi2__item">
                            <div class="summoner-summary">
                                <div class="last-updated">
                                    Last played: <span class="_timeago _timeCountAssigned tip" data-datetime=""
                                        data-type="" data-interval="60" title="">4 days ago</span>
                                </div>
                                <div class="tier-position">
                                    <div class="tier">
                                        <img class="tier__icon" src="">
                                    </div>
                                <!--
                                    <div class="most-position">
                                        <i class="most-position__icon most-position__icon--MID"></i>
                                    </div>
                                -->
                                </div>
                                <div class="summoner-name">
                                    <a class="name" href="#" target="_blank">
                                    </a>
                                </div>
                                <div class="lp"></div>
                                <div class="graph">
                                    <span class="winratio">50%</span>
                                </div>
                                <div class="win-streak win-streak--wins">
                                </div>
                            </div>
                            <div class="recent-matches">
                            <!--
                                <div class="title">Recently Played</div>
                                <div class="positions">
                                    <div class="position">
                                        <i class="position__icon position__icon--MID"></i>
                                        <div class="position__info">
                                            <div class="role-rate role-rate--high">50%</div>
                                            <div class="win-rate">W/R <strong>50%</strong></div>
                                        </div>
                                    </div>
                                    <div class="position">
                                        <i class="position__icon position__icon--TOP"></i>
                                        <div class="position__info">
                                            <div class="role-rate ">50%</div>
                                            <div class="win-rate">W/R <strong>50%</strong></div>
                                        </div>
                                    </div>
                                </div>
                            -->
                                <ul class="recent-games">
                                </ul>
                            </div>
                        </li>
                    </template>
                </ul>
                <template class="recent_game_template">
                    <li class="recent-games__item">
                        <div class="champion __sprite __spc20 __spc20-2 tip" title=""></div>
                        <img class="champion __sprite __spc20 __spc20-123 tip tpd-delegation-uid-1">
                        <div class="is-win is-win--true ">
                            <span class="kill"></span> /
                            <span class="death"></span> /
                            <span class="assist"></span>
                        </div>
                        <div class="time-stamp"><span class="_timeago _timeCountAssigned tip tpd-delegation-uid-1"
                                data-datetime="" data-type="" data-interval="60" title="" data-toggle="tooltip"></span>
                        </div>
                    </li>
                </template>
            </div>
        </div>
    </div>
</body>
<script>

    function timeConverter(UNIX_timestamp) {
        a = new Date(UNIX_timestamp * 1000);
        months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        year = a.getFullYear();
        month = months[a.getMonth()];
        date = a.getDate();
        hour = a.getHours();
        min = a.getMinutes();
        sec = a.getSeconds();
        time = date + ' ' + month + ' ' + year + ' ' + hour + ':' + min + ':' + sec;
        return time;
    }

    function secondsToDhms(seconds) {
        seconds = Number(seconds);
        var d = Math.floor(seconds / (3600 * 24));
        var h = Math.floor(seconds % (3600 * 24) / 3600);
        var m = Math.floor(seconds % 3600 / 60);
        var s = Math.floor(seconds % 60);

        var dDisplay = d > 0 ? d + (d == 1 ? " day, " : " days, ") : "";
        var hDisplay = h > 0 ? h + (h == 1 ? " hour, " : " hours ") : "";
        var mDisplay = m > 0 ? m + (m == 1 ? " minute, " : " minutes, ") : "";
        var sDisplay = s > 0 ? s + (s == 1 ? " second" : " seconds") : "";
        return dDisplay + hDisplay + " ago"
    }

    user1Param = {
        "data": [{
            "all_champion_num": 152,
            "all_skin_num": 1144,
            "area_id": 31,
            "area_name": "\u5ce1\u8c37\u4e4b\u5dc5",
            "champion_num": 114,
            "game_age": 0,
            "game_id": 26,
            "game_level": 182,
            "game_logo_url": "https://wegame.gtimg.com/g.26-r.c2d3c/helper/lol/assis/images/resources/usericon/3861.png",
            "gender": 0,
            "league_point": 1115,
            "measure_unit": 0,
            "online_status": 0,
            "online_zone_id": 0,
            "power_value": 91761,
            "praise_time": 0,
            "rank": 0,
            "recent_kda": 893,
            "recent_total_games": 69,
            "recent_total_kill": 519,
            "recent_win_rate": 44,
            "result": 0,
            "role_name": "2020LYAMO1",
            "skin_num": 61,
            "slol_id": "5m3EjQ4odvB",
            "tier": 0,
            "total_assist": 12492,
            "total_games": 1557,
            "total_kill": 16623,
            "total_placed": 16152,
            "total_time": 7655674,
            "win_rate": 53,
            "continue_lose": 4,
            "continue_win": 0,
        }],
        "player_battle_brief_list": [
            {
                "assist_num": 8,
                "battle_id": 91193936,
                "battle_time": 1606638699,
                "champion_en_name": "Akali",
                "champion_id": 84,
                "death_num": 3,
                "ext_tag_desc": "\u7529\u9505\u5c40",
                "ext_tag_id": 10,
                "game_mode_id": 4,
                "game_mode_name": "\u5355\u53cc\u6392\u4f4d",
                "game_result": 2,
                "game_score": 950,
                "kill_num": 3,
                "position": 0,
                "pv_delta": -203
            },
            {
                "assist_num": 1,
                "battle_flags": [
                    3
                ],
                "battle_id": 91201414,
                "battle_time": 1606587622,
                "champion_en_name": "",
                "champion_id": 517,
                "death_num": 3,
                "ext_tag_desc": "\u7529\u9505\u5c40",
                "ext_tag_id": 10,
                "game_mode_id": 4,
                "game_mode_name": "\u5355\u53cc\u6392\u4f4d",
                "game_result": 2,
                "game_score": 880,
                "kill_num": 3,
                "position": 0,
                "pv_delta": -177
            },
            {
                "assist_num": 0,
                "battle_id": 91180250,
                "battle_time": 1606569239,
                "champion_en_name": "Akali",
                "champion_id": 84,
                "death_num": 6,
                "ext_tag_desc": "\u80cc\u9505\u5c40",
                "ext_tag_id": 2,
                "game_mode_id": 4,
                "game_mode_name": "\u5355\u53cc\u6392\u4f4d",
                "game_result": 2,
                "game_score": 400,
                "kill_num": 1,
                "position": 0,
                "pv_delta": -275
            },
            {
                "assist_num": 1,
                "battle_id": 91199717,
                "battle_time": 1606566739,
                "champion_en_name": "Jayce",
                "champion_id": 126,
                "death_num": 7,
                "ext_tag_desc": "\u80cc\u9505\u5c40",
                "ext_tag_id": 2,
                "game_mode_id": 4,
                "game_mode_name": "\u5355\u53cc\u6392\u4f4d",
                "game_result": 2,
                "game_score": 460,
                "kill_num": 3,
                "position": 0,
                "pv_delta": -261
            },
            {
                "assist_num": 4,
                "battle_flags": [
                    1
                ],
                "battle_id": 91169679,
                "battle_time": 1606564470,
                "champion_en_name": "",
                "champion_id": 246,
                "death_num": 1,
                "ext_tag_desc": "\u78be\u538b\u5c40",
                "ext_tag_id": 9,
                "ext_tag_ids": [
                    19
                ],
                "game_mode_id": 4,
                "game_mode_name": "\u5355\u53cc\u6392\u4f4d",
                "game_result": 1,
                "game_score": 1140,
                "kill_num": 10,
                "position": 0,
                "pv_delta": 317
            },
            {
                "assist_num": 12,
                "battle_id": 91179530,
                "battle_time": 1606562111,
                "champion_en_name": "Taric",
                "champion_id": 44,
                "death_num": 9,
                "ext_tag_desc": "\u80cc\u9505\u5c40",
                "ext_tag_id": 2,
                "game_mode_id": 4,
                "game_mode_name": "\u5355\u53cc\u6392\u4f4d",
                "game_result": 2,
                "game_score": 380,
                "kill_num": 2,
                "position": 0,
                "pv_delta": -282
            },
            {
                "assist_num": 4,
                "battle_id": 91169102,
                "battle_time": 1606559341,
                "champion_en_name": "Akali",
                "champion_id": 84,
                "death_num": 6,
                "ext_tag_desc": "\u7529\u9505\u5c40",
                "ext_tag_id": 10,
                "game_mode_id": 4,
                "game_mode_name": "\u5355\u53cc\u6392\u4f4d",
                "game_result": 2,
                "game_score": 760,
                "kill_num": 5,
                "position": 0,
                "pv_delta": -239
            },
            {
                "assist_num": 11,
                "battle_flags": [
                    1
                ],
                "battle_id": 91178901,
                "battle_time": 1606556426,
                "champion_en_name": "Renekton",
                "champion_id": 58,
                "death_num": 5,
                "game_mode_id": 4,
                "game_mode_name": "\u5355\u53cc\u6392\u4f4d",
                "game_result": 1,
                "game_score": 1250,
                "kill_num": 8,
                "position": 0,
                "pv_delta": 311
            },
            {
                "assist_num": 7,
                "battle_id": 91178587,
                "battle_time": 1606553209,
                "champion_en_name": "Akali",
                "champion_id": 84,
                "death_num": 5,
                "ext_tag_desc": "\u7529\u9505\u5c40",
                "ext_tag_id": 10,
                "game_mode_id": 4,
                "game_mode_name": "\u5355\u53cc\u6392\u4f4d",
                "game_result": 2,
                "game_score": 860,
                "kill_num": 5,
                "position": 3,
                "pv_delta": -213
            },
            {
                "assist_num": 2,
                "battle_id": 91165955,
                "battle_time": 1606496853,
                "champion_en_name": "",
                "champion_id": 517,
                "death_num": 6,
                "ext_tag_desc": "\u7529\u9505\u5c40",
                "ext_tag_id": 10,
                "game_mode_id": 4,
                "game_mode_name": "\u5355\u53cc\u6392\u4f4d",
                "game_result": 2,
                "game_score": 870,
                "kill_num": 3,
                "position": 0,
                "pv_delta": -212
            }]
    };

    /**

    format of json

    json = {
        data: [{
            playinfo
        }],
        player_battle_brief_list: [{
            recent-gameinfo
        }]
        
    }

    */

    //queryString = '1=' + JSON.stringify(user1Param) + '&2=' + JSON.stringify(user1Param) + '&3=' + JSON.stringify(user1Param) + '&4=' + JSON.stringify(user1Param) + '&5=' + JSON.stringify(user1Param);
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const weCDN = "https://wegame.gtimg.com/g.26-r.c2d3c/helper/lol/assis/images/resources/champions/"
    const wegameRank = "https://wegame.gtimg.com/app/lol/score_souces/division/"
    i = 0;
    for (const [key, value] of urlParams) {
        jsonData = JSON.parse(value)
        console.log(jsonData)

        //begin create users
        temp = document.getElementsByTagName("template")[0];
        view = document.getElementsByClassName("multi2__list")[0];
        startElement = temp.content.querySelector("li");
        posArray = [0, 0, 0, 0, 0]
        a = document.importNode(startElement, true);

        //shorthand
        player = jsonData
        battle_list = jsonData["player_battle_brief_list"]
        f = function (arguments) { return a.getElementsByClassName(arguments); }

        for (z = 0; z < Object.keys(battle_list).length; z++) {
            posArray[battle_list[z]["position"]] += 1
        }
        console.log(posArray)

        console.log(player)


        //populate user data from JSON
        f("summoner-name")[0].innerHTML = "<a class='name' href='#'>" + player["role_name"] + "</a>"
        f("tier__icon")[0].src = wegameRank + player["rank"] + ".png"
        f("lp")[0].innerText = player["league_point"] + "LP"
        f("winratio")[0].innerText = player["win_rate"] + "%"

        if (player["continue_lose"] > 0) {
            f("win-streak")[0].innerText = player["continue_lose"] + " game lose streak"
            f("win-streak")[0].style.backgroundColor = "red";
        } else if (player["continue_win"] > 0) {
            f("win-streak")[0].innerText = player["continue_win"] + " game win streak"
        } else {
            f("win-streak")[0].innerText = ""
        }

        view.appendChild(a);

        //top last played text
        if (battle_list[0]["battle_time"]) {
            deltaT = Date.now()/1000 - battle_list[0]["battle_time"]
            lastPlayed = (secondsToDhms(deltaT))
            f("_timeago")[0].innerText = lastPlayed
        } else {
            f("_timeago")[0].innerText = "No recent games on record"
        }

        recentview = view.getElementsByClassName("recent-games")[i]
        recentList = document.getElementsByTagName("template")[1].content.querySelector("li");

        f = function (arguments) { return b.getElementsByClassName(arguments); }

        for (z = 0; z < Object.keys(battle_list).length; z++) {
            //begin create user match history
            b = document.importNode(recentList, true);
            if (jsonData["player_battle_brief_list"][z]["champion_id"]) {
                f("champion __sprite __spc20 __spc20-123 tip tpd-delegation-uid-1")[0].src = weCDN + battle_list[z]["champion_id"] + ".png"
                f("kill")[0].innerText = battle_list[z]["kill_num"]
                f("death")[0].innerText = battle_list[z]["death_num"]
                f("assist")[0].innerText = battle_list[z]["assist_num"]
                f("_timeago")[0].setAttribute("data-datetime", battle_list[z]["battle_time"]);
                f("_timeago")[0].innerText = timeConverter(battle_list[z]["battle_time"]);
                f("_timeago")[0].title = timeConverter(battle_list[z]["battle_time"]);
                $('[data-toggle="tooltip"]').tooltip();
                recentview.appendChild(b);
            }
        }
        //move to next players match history
        i += 1;
    }

    window.addEventListener('message', function(event) {
        var origin = event.origin || event.originalEvent.origin; // For Chrome, the origin property is in the event.originalEvent object.
        if (origin !== "https://downthecrop.github.io/opgg-clone/")
            return;
        if (typeof event.data == 'object' && event.data.call=='sendValue') {
        console.log("I got a message!" + event.data.value)
        }
    }, false);

</script>

</html>